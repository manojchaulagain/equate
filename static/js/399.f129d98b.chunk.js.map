{"version":3,"file":"static/js/399.f129d98b.chunk.js","mappings":"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","sources":["components/notifications/UserNotifications.tsx","utils/timestampHelpers.ts","../node_modules/lucide-react/src/icons/bell.ts"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { Bell, Heart, Star } from \"lucide-react\";\nimport { collection, query, where, onSnapshot, doc, updateDoc, Timestamp } from \"firebase/firestore\";\nimport { FirestorePaths } from \"../../utils/firestorePaths\";\nimport { sortByTimestamp, getFormattedDate } from \"../../utils/timestampHelpers\";\n\ninterface UserNotification {\n  id: string;\n  userId: string;\n  type: \"kudos\" | \"motm\";\n  message: string;\n  fromUserEmail: string;\n  relatedPlayerId?: string;\n  relatedPlayerName?: string;\n  createdAt: Timestamp | any;\n  read: boolean;\n}\n\ninterface UserNotificationsProps {\n  db: any;\n  userId: string;\n}\n\nconst UserNotifications: React.FC<UserNotificationsProps> = ({ db, userId }) => {\n  const [notifications, setNotifications] = useState<UserNotification[]>([]);\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [showDropdown, setShowDropdown] = useState(false);\n  const [dropdownPosition, setDropdownPosition] = useState<{ top: number; right: number } | null>(null);\n  const buttonRef = useRef<HTMLButtonElement>(null);\n\n  useEffect(() => {\n    if (!db || !userId) return;\n\n    const notificationsPath = FirestorePaths.userNotifications();\n    const notificationsRef = collection(db, notificationsPath);\n    const q = query(notificationsRef, where(\"userId\", \"==\", userId));\n\n    const unsubscribe = onSnapshot(\n      q,\n      (snapshot) => {\n        const notificationsData = snapshot.docs.map((doc) => ({\n          id: doc.id,\n          ...doc.data(),\n        })) as UserNotification[];\n\n        // Sort notifications (newest first) and calculate unread count\n        const sortedNotifications = sortByTimestamp(notificationsData);\n        setNotifications(sortedNotifications);\n        // Calculate unread count in one pass\n        const unread = sortedNotifications.reduce((count, n) => count + (n.read ? 0 : 1), 0);\n        setUnreadCount(unread);\n      },\n      (err) => {\n        console.error(\"Error fetching notifications:\", err);\n      }\n    );\n\n    return () => unsubscribe();\n  }, [db, userId]);\n\n  const markAsRead = async (notificationId: string) => {\n    if (!db) return;\n\n    try {\n      const notificationPath = `${FirestorePaths.userNotifications()}/${notificationId}`;\n      const notificationRef = doc(db, notificationPath);\n      await updateDoc(notificationRef, { read: true });\n    } catch (err) {\n      console.error(\"Error marking notification as read:\", err);\n    }\n  };\n\n  const markAllAsRead = async () => {\n    if (!db || unreadCount === 0) return;\n\n    try {\n      const unreadNotifications = notifications.filter((n) => !n.read);\n\n      await Promise.all(\n        unreadNotifications.map((notification) => {\n          const notificationPath = `${FirestorePaths.userNotifications()}/${notification.id}`;\n          const notificationRef = doc(db, notificationPath);\n          return updateDoc(notificationRef, { read: true });\n        })\n      );\n    } catch (err) {\n      console.error(\"Error marking all notifications as read:\", err);\n    }\n  };\n\n  // Calculate dropdown position when opening\n  useEffect(() => {\n    if (showDropdown && buttonRef.current) {\n      const rect = buttonRef.current.getBoundingClientRect();\n      const popupWidth = Math.min(380, window.innerWidth - 16); // Max width with 8px margin on each side\n      const rightEdge = window.innerWidth - rect.right;\n      const leftEdge = rect.left;\n      \n      // Ensure popup stays within viewport\n      // If there's not enough space on the right, position from left instead\n      let right = rightEdge;\n      if (rightEdge < 8) {\n        right = window.innerWidth - leftEdge - popupWidth;\n      }\n      right = Math.max(8, Math.min(right, window.innerWidth - popupWidth - 8));\n      \n      // Check if popup would go below viewport\n      const estimatedHeight = Math.min(500, window.innerHeight - 100); // Max height with some margin\n      const spaceBelow = window.innerHeight - rect.bottom;\n      let top = rect.bottom + 8;\n      if (spaceBelow < estimatedHeight && rect.top > estimatedHeight) {\n        // Position above button if not enough space below\n        top = rect.top - estimatedHeight - 8;\n      }\n      \n      setDropdownPosition({\n        top: Math.max(8, top),\n        right: right,\n      });\n    } else {\n      setDropdownPosition(null);\n    }\n  }, [showDropdown]);\n\n\n  return (\n    <div className=\"relative flex-shrink-0\">\n      <button\n        ref={buttonRef}\n        onClick={() => setShowDropdown(!showDropdown)}\n        className=\"relative w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-white/10 backdrop-blur-sm flex items-center justify-center text-slate-300 hover:text-white hover:bg-white/20 transition-all duration-300 hover:scale-110 border border-white/20 focus:outline-none focus:ring-2 focus:ring-white/50\"\n        aria-label=\"Notifications\"\n      >\n        <Bell className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n        {unreadCount > 0 && (\n          <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center border-2 border-slate-900/50\">\n            {unreadCount > 9 ? \"9+\" : unreadCount}\n          </span>\n        )}\n      </button>\n\n      {showDropdown && (\n        <>\n          <div\n            className=\"fixed inset-0 z-[110]\"\n            onClick={() => setShowDropdown(false)}\n          />\n          {dropdownPosition && (\n            <div \n              className=\"fixed w-[320px] sm:w-[380px] max-w-[calc(100vw-1rem)] bg-white rounded-2xl shadow-2xl border-2 border-slate-200 z-[120] overflow-hidden flex flex-col\"\n              style={{\n                top: `${dropdownPosition.top}px`,\n                right: `${dropdownPosition.right}px`,\n                left: 'auto',\n                maxHeight: `calc(100vh - ${dropdownPosition.top + 8}px)`,\n              }}\n            >\n            <div className=\"p-4 border-b border-slate-200 flex items-center justify-between bg-gradient-to-r from-slate-50 to-blue-50\">\n              <h3 className=\"font-bold text-slate-800 flex items-center gap-2\">\n                <Bell className=\"w-5 h-5 text-blue-600\" />\n                Notifications\n              </h3>\n              {unreadCount > 0 && (\n                <button\n                  onClick={markAllAsRead}\n                  className=\"text-xs text-blue-600 hover:text-blue-800 font-semibold\"\n                >\n                  Mark all read\n                </button>\n              )}\n            </div>\n\n            <div className=\"overflow-y-auto flex-1\">\n              {notifications.length === 0 ? (\n                <div className=\"p-8 text-center\">\n                  <Bell className=\"mx-auto text-slate-400 mb-2\" size={32} />\n                  <p className=\"text-sm text-slate-600\">No notifications</p>\n                </div>\n              ) : (\n                <div className=\"divide-y divide-slate-100\">\n                  {notifications.map((notification) => (\n                    <div\n                      key={notification.id}\n                      className={`p-4 hover:bg-slate-50 transition-colors cursor-pointer ${\n                        !notification.read ? \"bg-blue-50/50\" : \"\"\n                      }`}\n                      onClick={() => {\n                        if (!notification.read) {\n                          markAsRead(notification.id);\n                        }\n                      }}\n                    >\n                      <div className=\"flex items-start gap-3\">\n                        <div\n                          className={`p-2 rounded-xl flex-shrink-0 ${\n                            notification.type === \"kudos\"\n                              ? \"bg-gradient-to-br from-pink-500 to-rose-600\"\n                              : \"bg-gradient-to-br from-yellow-500 to-amber-600\"\n                          }`}\n                        >\n                          {notification.type === \"kudos\" ? (\n                            <Heart className=\"text-white\" size={18} />\n                          ) : (\n                            <Star className=\"text-white\" size={18} />\n                          )}\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-sm font-semibold text-slate-800 mb-1\">\n                            {notification.message}\n                          </p>\n                          <p className=\"text-xs text-slate-500\">\n                            {getFormattedDate(notification.createdAt)}\n                          </p>\n                        </div>\n                        {!notification.read && (\n                          <div className=\"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0 mt-2\" />\n                        )}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default UserNotifications;\n\n","/**\n * Utility functions for handling Firestore Timestamps\n * Centralizes date/time conversion logic\n */\n\nimport { Timestamp } from \"firebase/firestore\";\n\n/**\n * Convert a Firestore timestamp to a JavaScript Date\n */\nexport function timestampToDate(timestamp: Timestamp | any): Date | null {\n  if (!timestamp) return null;\n  \n  if (timestamp.toDate && typeof timestamp.toDate === \"function\") {\n    return timestamp.toDate();\n  }\n  \n  if (timestamp.seconds) {\n    return new Date(timestamp.seconds * 1000);\n  }\n  \n  return null;\n}\n\n/**\n * Get formatted date string from timestamp\n */\nexport function getFormattedDate(timestamp: Timestamp | any): string {\n  const date = timestampToDate(timestamp);\n  if (!date) return \"N/A\";\n  \n  return date.toLocaleString();\n}\n\n/**\n * Get timestamp in milliseconds for sorting\n */\nexport function getTimestampMs(timestamp: Timestamp | any): number {\n  if (!timestamp) return 0;\n  \n  if (timestamp.toMillis && typeof timestamp.toMillis === \"function\") {\n    return timestamp.toMillis();\n  }\n  \n  if (timestamp.seconds) {\n    return timestamp.seconds * 1000;\n  }\n  \n  return 0;\n}\n\n/**\n * Sort array by timestamp (descending - newest first)\n */\nexport function sortByTimestamp<T extends { createdAt?: Timestamp | any }>(\n  items: T[]\n): T[] {\n  return [...items].sort((a, b) => {\n    const aTime = getTimestampMs(a.createdAt);\n    const bTime = getTimestampMs(b.createdAt);\n    return bTime - aTime;\n  });\n}\n\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M10.268 21a2 2 0 0 0 3.464 0', key: 'vwvbt9' }],\n  [\n    'path',\n    {\n      d: 'M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326',\n      key: '11g9vi',\n    },\n  ],\n];\n\n/**\n * @component @name Bell\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTAuMjY4IDIxYTIgMiAwIDAgMCAzLjQ2NCAwIiAvPgogIDxwYXRoIGQ9Ik0zLjI2MiAxNS4zMjZBMSAxIDAgMCAwIDQgMTdoMTZhMSAxIDAgMCAwIC43NC0xLjY3M0MxOS40MSAxMy45NTYgMTggMTIuNDk5IDE4IDhBNiA2IDAgMCAwIDYgOGMwIDQuNDk5LTEuNDExIDUuOTU2LTIuNzM4IDcuMzI2IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/bell\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Bell = createLucideIcon('bell', __iconNode);\n\nexport default Bell;\n"],"names":["_ref","db","userId","notifications","setNotifications","useState","unreadCount","setUnreadCount","showDropdown","setShowDropdown","dropdownPosition","setDropdownPosition","buttonRef","useRef","useEffect","notificationsPath","FirestorePaths","userNotifications","notificationsRef","collection","q","query","where","unsubscribe","onSnapshot","snapshot","notificationsData","docs","map","doc","_objectSpread","id","data","sortedNotifications","sortByTimestamp","unread","reduce","count","n","read","err","console","error","current","rect","getBoundingClientRect","popupWidth","Math","min","window","innerWidth","rightEdge","right","leftEdge","left","max","estimatedHeight","innerHeight","spaceBelow","bottom","top","_jsxs","className","children","ref","onClick","_jsx","Bell","_Fragment","style","concat","maxHeight","async","unreadNotifications","filter","Promise","all","notification","notificationPath","notificationRef","updateDoc","length","size","notificationId","markAsRead","type","Heart","Star","message","getFormattedDate","createdAt","timestamp","date","toDate","seconds","Date","timestampToDate","toLocaleString","getTimestampMs","toMillis","items","sort","a","b","aTime","createLucideIcon","d","key"],"ignoreList":[],"sourceRoot":""}