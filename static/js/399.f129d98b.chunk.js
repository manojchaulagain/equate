/*! For license information please see 399.f129d98b.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkequate=self.webpackChunkequate||[]).push([[399],{4399:(e,t,s)=>{s.r(t),s.d(t,{default:()=>x});var i=s(2555),a=s(5043),r=s(9233),n=s(4918),o=s(3944),l=s(6667),c=s(8629),d=s(8927),u=s(579);const x=e=>{let{db:t,userId:s}=e;const[x,h]=(0,a.useState)([]),[m,f]=(0,a.useState)(0),[b,w]=(0,a.useState)(!1),[p,g]=(0,a.useState)(null),N=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!t||!s)return;const e=c.ON.userNotifications(),a=(0,l.rJ)(t,e),r=(0,l.P)(a,(0,l._M)("userId","==",s)),n=(0,l.aQ)(r,e=>{const t=e.docs.map(e=>(0,i.A)({id:e.id},e.data())),s=(0,d.qW)(t);h(s);const a=s.reduce((e,t)=>e+(t.read?0:1),0);f(a)},e=>{console.error("Error fetching notifications:",e)});return()=>n()},[t,s]);return(0,a.useEffect)(()=>{if(b&&N.current){const e=N.current.getBoundingClientRect(),t=Math.min(380,window.innerWidth-16),s=window.innerWidth-e.right,i=e.left;let a=s;s<8&&(a=window.innerWidth-i-t),a=Math.max(8,Math.min(a,window.innerWidth-t-8));const r=Math.min(500,window.innerHeight-100),n=window.innerHeight-e.bottom;let o=e.bottom+8;n<r&&e.top>r&&(o=e.top-r-8),g({top:Math.max(8,o),right:a})}else g(null)},[b]),(0,u.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,u.jsxs)("button",{ref:N,onClick:()=>w(!b),className:"relative w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-white/10 backdrop-blur-sm flex items-center justify-center text-slate-300 hover:text-white hover:bg-white/20 transition-all duration-300 hover:scale-110 border border-white/20 focus:outline-none focus:ring-2 focus:ring-white/50","aria-label":"Notifications",children:[(0,u.jsx)(r.A,{className:"w-4 h-4 sm:w-5 sm:h-5"}),m>0&&(0,u.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center border-2 border-slate-900/50",children:m>9?"9+":m})]}),b&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"fixed inset-0 z-[110]",onClick:()=>w(!1)}),p&&(0,u.jsxs)("div",{className:"fixed w-[320px] sm:w-[380px] max-w-[calc(100vw-1rem)] bg-white rounded-2xl shadow-2xl border-2 border-slate-200 z-[120] overflow-hidden flex flex-col",style:{top:"".concat(p.top,"px"),right:"".concat(p.right,"px"),left:"auto",maxHeight:"calc(100vh - ".concat(p.top+8,"px)")},children:[(0,u.jsxs)("div",{className:"p-4 border-b border-slate-200 flex items-center justify-between bg-gradient-to-r from-slate-50 to-blue-50",children:[(0,u.jsxs)("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[(0,u.jsx)(r.A,{className:"w-5 h-5 text-blue-600"}),"Notifications"]}),m>0&&(0,u.jsx)("button",{onClick:async()=>{if(t&&0!==m)try{const e=x.filter(e=>!e.read);await Promise.all(e.map(e=>{const s="".concat(c.ON.userNotifications(),"/").concat(e.id),i=(0,l.H9)(t,s);return(0,l.mZ)(i,{read:!0})}))}catch(e){console.error("Error marking all notifications as read:",e)}},className:"text-xs text-blue-600 hover:text-blue-800 font-semibold",children:"Mark all read"})]}),(0,u.jsx)("div",{className:"overflow-y-auto flex-1",children:0===x.length?(0,u.jsxs)("div",{className:"p-8 text-center",children:[(0,u.jsx)(r.A,{className:"mx-auto text-slate-400 mb-2",size:32}),(0,u.jsx)("p",{className:"text-sm text-slate-600",children:"No notifications"})]}):(0,u.jsx)("div",{className:"divide-y divide-slate-100",children:x.map(e=>(0,u.jsx)("div",{className:"p-4 hover:bg-slate-50 transition-colors cursor-pointer ".concat(e.read?"":"bg-blue-50/50"),onClick:()=>{e.read||(async e=>{if(t)try{const s="".concat(c.ON.userNotifications(),"/").concat(e),i=(0,l.H9)(t,s);await(0,l.mZ)(i,{read:!0})}catch(s){console.error("Error marking notification as read:",s)}})(e.id)},children:(0,u.jsxs)("div",{className:"flex items-start gap-3",children:[(0,u.jsx)("div",{className:"p-2 rounded-xl flex-shrink-0 ".concat("kudos"===e.type?"bg-gradient-to-br from-pink-500 to-rose-600":"bg-gradient-to-br from-yellow-500 to-amber-600"),children:"kudos"===e.type?(0,u.jsx)(n.A,{className:"text-white",size:18}):(0,u.jsx)(o.A,{className:"text-white",size:18})}),(0,u.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,u.jsx)("p",{className:"text-sm font-semibold text-slate-800 mb-1",children:e.message}),(0,u.jsx)("p",{className:"text-xs text-slate-500",children:(0,d.po)(e.createdAt)})]}),!e.read&&(0,u.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0 mt-2"})]})},e.id))})})]})]})]})}},8927:(e,t,s)=>{function i(e){const t=function(e){return e?e.toDate&&"function"===typeof e.toDate?e.toDate():e.seconds?new Date(1e3*e.seconds):null:null}(e);return t?t.toLocaleString():"N/A"}function a(e){return e?e.toMillis&&"function"===typeof e.toMillis?e.toMillis():e.seconds?1e3*e.seconds:0:0}function r(e){return[...e].sort((e,t)=>{const s=a(e.createdAt);return a(t.createdAt)-s})}s.d(t,{di:()=>a,po:()=>i,qW:()=>r})},9233:(e,t,s)=>{s.d(t,{A:()=>i});const i=(0,s(7784).A)("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]])}}]);
//# sourceMappingURL=399.f129d98b.chunk.js.map